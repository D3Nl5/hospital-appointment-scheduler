<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AppointmentPlus - Profile</title>
    <link rel="icon" href="images/appointmentPlus_small.png">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Add your custom CSS if needed -->
    <link rel="stylesheet" href="stylesLogo.css">
    <link rel="stylesheet" href="stylesNavBar.css">
    <link rel="stylesheet" href="styleLogRegForms.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Add Bootstrap and jQuery scripts -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</head>
<body>

<!-- Navbar -->
<header>
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="index.html"><img class="logo" src="images/appointmentPlus.png" alt="Your Logo"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item" id="home-nav">
                        <a class="nav-link" href="index.html">
                            <div class="image-container">
                                <img class="logo" style="height: 35px; width: 35px;" src="images/home.png" alt="Your Logo">
                                <span class="hint">Homepage</span>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item d-none" id="appointments-nav">
                        <a class="nav-link" href="available-appointments.html">
                            <div class="image-container">
                                <img class="logo" style="height: 35px; width: 35px;" src="images/appointments.png" alt="Your Logo">
                                <span class="hint">Appointments</span>
                            </div>
                        </a>
                    </li>
                    <!-- <li class="nav-item" id="contact-nav">
                        <a class="nav-link" href="contact.html">
                            <div class="image-container">
                                <img class="logo" style="height: 35px; width: 35px;" src="images/contact.png" alt="Your Logo">
                                <span class="hint">Contact</span>
                            </div>
                        </a>
                    </li> -->
                    <li class="nav-item d-none" id="profile-nav">
                        <a class="nav-link" href="profile.html">
                            <div class="image-container">
                                <img class="logo" style="height: 35px; width: 35px;" src="images/profile.png" alt="Your Logo">
                                <span class="hint">Profile</span>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item d-none" id="history-nav">
                        <a class="nav-link" href="history.html">
                            <div class="image-container">
                                <img class="logo" style="height: 35px; width: 35px;" src="images/history.png" alt="Your Logo">
                                <span class="hint">My History</span>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item d-none" id="admin-users-nav">
                        <a class="nav-link" href="admin-users.html">
                            <div class="image-container">
                                <img class="logo" style="height: 35px; width: 35px;" src="images/admin-users.png" alt="Your Logo">
                                <span class="hint">Manage Users</span>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item d-none" id="admin-history-nav">
                        <a class="nav-link" href="admin-history.html">
                            <div class="image-container">
                                <img class="logo" style="height: 35px; width: 35px;" src="images/admin-history.png" alt="Your Logo">
                                <span class="hint">Manage Appointments</span>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item d-none" id="logout-nav">
                        <a class="nav-link" href="index.html" onclick="logout()">
                            <div class="image-container">
                                <img class="logo" style="height: 35px; width: 35px;" src="images/logout.png" alt="Your Logo">
                                <span class="hint">Logout</span>
                            </div>
                        </a>
                    </li>
                    <!-- <li class="nav-item">
                        <a class="nav-link" href="#">Services</a>
                    </li> -->
                    <!-- <li class="nav-item">
                        <a class="nav-link" href="available-appointments.html" id="appointments-nav" >Appointments</a>
                    </li> -->
                    <!-- <li class="nav-item">
                        <a class="nav-link" href="available-appointments.html" id="appointments-nav" >Appointments</a>
                    </li> -->
                    <!-- <li class="nav-item">
                        <a class="nav-link" href="contact.html">Contact</a>
                    </li> -->
                    <!-- <li class="nav-item d-none" id="logout-nav" >
                        <a class="nav-link" href="index.html" onclick="logout()"><img class="logo" style="height: 35px;" src="images/logout.png" alt="Your Logo"></a>
                    </li> -->
                    <!-- <li class="nav-item">
                        <button class="btn btn-primary">Book Appointment</button>
                    </li> -->
                </ul>
                <span class="navbar-text ml-auto d-none" id="welcome-text">
                    Welcome, <span id="username"></span>
                </span>
            </div>
        </div>
    </nav>
</header>

<!-- Modal for Success Message -->
<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="successModalLabel">Success</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Patient updated successfully.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Error Message -->
<div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="errorModalLabel">Error</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Failed to add patient. Please try again.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Profile Form Tab -->
<div class="tab-content mt-3">
    <div class="tab-pane fade show active" id="profileTab">
        <div class="form-container">
            <h2 class="form-title">Patient's Profile</h2>
            <form id="profileForm">
                <!-- First Name -->
                <div class="form-group">
                    <label for="editFirstName">First Name</label>
                    <input type="text" class="form-control" id="editFirstName" name="firstName" placeholder="e.g. John" required>
                </div>
                <!-- Last Name -->
                <div class="form-group">
                    <label for="editLastName">Last Name</label>
                    <input type="text" class="form-control" id="editLastName" name="lastName" placeholder="e.g. Doe" required>
                </div>
                <!-- Email -->
                <div class="form-group">
                    <label for="editEmail">Email</label>
                    <input type="email" class="form-control" id="editEmail" name="email" placeholder="Your Email" required>
                </div>
                <!-- Password -->
                <div class="form-group">
                    <label for="editPassword">Password</label>
                    <input type="password" class="form-control" id="editPassword" name="password" placeholder="Your Password" required>
                </div>
                <!-- Date of Birth -->
                <div class="form-group">
                    <label for="editDob">Date of Birth</label>
                    <input type="date" class="form-control" id="editDob" name="dob" placeholder="e.g. 1990-01-15" required>
                </div>
                <!-- Weight -->
                <div class="form-group">
                    <label for="editWeight">Weight (kg)</label>
                    <input type="number" class="form-control" id="editWeight" name="weight" placeholder="e.g. 70" required>
                </div>
                <!-- Height -->
                <div class="form-group">
                    <label for="editHeight">Height (cm)</label>
                    <input type="number" class="form-control" id="editHeight" name="height" placeholder="e.g. 175" required>
                </div>
                <!-- Save Profile Changes button -->
                <button id="saveProfileButton" class="form-btn btn-primary" type="submit">Save Changes</button>
            </form>
        </div>
    </div>
</div>

<!-- Add a script section at the end of the body to populate the form fields with patient information -->
<script>
    // Fetch the patient data from the backend API
    fetch('/profile') // Replace with your actual endpoint to fetch patient data
        .then(response => response.json())
        .then(data => {
            if (data && data.patient && data.patient.firstName) {
                // Assuming 'data' contains the patient information
                const patient = data.patient;

                // Fill the form fields with the patient information
                document.getElementById('editFirstName').value = patient.firstName;
                document.getElementById('editLastName').value = patient.lastName;
                document.getElementById('editEmail').value = patient.email;
                document.getElementById('editPassword').value = patient.password;
                document.getElementById('editDob').value = patient.dob;
                document.getElementById('editWeight').value = patient.weight;
                document.getElementById('editHeight').value = patient.height;
            } else {
                console.error('Patient data not found or has invalid structure');
                // Handle the error appropriately, such as displaying an error message or taking other actions
                $('#errorModal .modal-body').text('Patient data not found or has invalid structure. Check if you have logged in correctly.');
                $('#errorModal').modal('show');
            }
        })
        .catch(error => {
            console.error('Error fetching patient data:', error);
            // Handle the error appropriately, such as displaying an error message or taking other actions
            $('#errorModal .modal-body').text('Error fetching patient data');
            $('#errorModal').modal('show');
        });

</script>

<script>
    // Function to handle form submission
    document.getElementById('profileForm').addEventListener('submit', function (event) {
        event.preventDefault();

        const form = event.target;
        const formData = new FormData(form);
        const jsonData = {};

        for (const [key, value] of formData.entries()) {
            jsonData[key] = value;
        }

        // Remove the empty password field before sending the data
        delete jsonData['editPassword'];

        // console.log(JSON.stringify(jsonData));

        fetch('/updateProfile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(jsonData)
        })
        .then(response => response.json())
        .then(data => {
            if (data && data.message) {
                // Display success message
                $('#successModal').modal('show');
            } else {
                // Display error message
                $('#errorModal .modal-body').text(data.error);
                $('#errorModal').modal('show');
            }
        })
        .catch(error => {
            // console.error('Error updating profile:', error);
            // Handle the error appropriately
            $('#errorModal').modal('show');
        });
    });
</script>


<script src="navbarfunction.js"></script>

</body>
</html>